\documentclass[a4paper, 11pt]{article}
    \usepackage{CJKutf8}
    \usepackage{geometry}
    \usepackage[utf8]{inputenc}
    \usepackage[colorlinks, linkcolor=blue]{hyperref}
    \usepackage[linesnumbered, boxed, ruled, commentsnumbered]{algorithm2e}
    \title{区块链安全综述}
    \author{林文海(11721018)}
    \date{2018年06月10日}
    
    \begin{document}
    \setlength\parindent{2em}

        %%%% 重定义 %%%%
        \renewcommand{\contentsname}{目录}  % 将Contents改为目录
        \renewcommand{\abstractname}{摘要}  % 将Abstract改为摘要
        \renewcommand{\refname}{参考文献}   % 将References改为参考文献
        \renewcommand{\indexname}{索引}
        \renewcommand{\figurename}{图}
        \renewcommand{\tablename}{表}
        \renewcommand{\appendixname}{附录}
    
    \begin{CJK*}{UTF8}{gbsn}

    \maketitle
    
    \begin{abstract}
        这是中文摘要。这是中文摘要。这是中文摘要。这是中文摘要。这是中文摘要。这是中文摘要。这是中文摘要。
        这是中文摘要。这是中文摘要。这是中文摘要。这是中文摘要。这是中文摘要。这是中文摘要。这是中文摘要。这是中文摘要。
        这是中文摘要。这是中文摘要。这是中文摘要。这是中文摘要。这是中文摘要。这是中文摘要。这是中文摘要。这是中文摘要。
    \end{abstract}

    \renewcommand{\abstractname}{Abstract}

    \begin{abstract}
        This is abstract in English.This is abstract in English.This is abstract in English.
        This is abstract in English.This is abstract in English.This is abstract in English.
        This is abstract in English.This is abstract in English.This is abstract in English.
    \end{abstract}

    \section{前言}

    \indent

    比特币\cite{ref_article1}是第一个完全去中心化的电子货币系统。
    自从比特币在2009发行以来，
    它的价值已经获得巨大的提升，
    截止2018年6月10日，
    单个比特币的价值为
    7311.87美元，
    比特币总市值已经突破1249亿美元\cite{ref_web1}。


    比特币以去中心化以及安全性著称，
    但事实上依然存在着可以被人利用的漏洞，
    本文对近几年来针对比特币挖矿攻击的研究进行了归纳概括，
    其中主要介绍Selfish Mining攻击\cite{ref_selfish_mining1, ref_selfish_mining2, ref_selfish_mining3}、
    BWH攻击\cite{ref_BWH1, ref_BWH2, ref_article3}以及FAW攻击\cite{ref_FAW}。本文的组织结构如下：
    \begin{itemize}
        \item 第一节前沿介绍背景以及本文的综述内容。
        \item 第二节介绍本文需要的比特币基础知识，包括比特币基本原理、挖矿过程以及区块链分叉。
        \item 第三、四、五分别介绍了Selfish Mining攻击、BWH攻击和FAW攻击，具体包括攻击的基本原理、攻击效果、攻击的改进版本、如何预防攻击等。
        \item 第六节对全文进行总结。

    \end{itemize}

    \section{比特币基础}

    \indent
    
    比特币的核心是基于区块链技术，
    区块链本质上是一种分布式账本，
    它记录着比特币系统的所有历史交易信息。
    为了保证分布式账本的内容不会被随意篡改，
    比特币系统需要网络中的P2P节点使用它们的算力
    去解决某种哈希计算题，
    以此来产生工作量证明PoW，
    想要产生一个区块同时将交易加入到区块中就必须要有PoW。
    我们将产生区块的过程称为“挖矿”，
    参与挖矿的P2P节点我们称之为“矿工”。
    当矿工挖出一个新的区块后会立即把新区块通过比特币网络进行广播并开始下一轮的挖矿，
    其他节点会对新区块进行校验，如果校验合法，那么新区块
    将被加入到原有的区块链的头，
    从而延长整个区块链。
    如果矿工挖出来的块获得网络上大多数节点的认可，
    那么矿工将获得一些比特币作为奖励。
    新的区块中的头保存着前一个区块的哈希值，
    如果前一个区块内容发生改变，
    那么将要重新进行PoW，
    并且导致后面的区块内容也发生变化，
    也要重新进行PoW。
    因此，随着区块链越来越长，
    篡改越早以前的区块的代价将越大，
    这就保证了区块链上数据具有不可篡改的特性。


    截止2018年06月，
    每挖到一个新区块的矿工将获得最少12.5个比特币作为奖励，
    除此之外，新区块中包含的所有
    交易的手续费也将作为矿工的奖励。
    根据比特币的设计，
    新区块的产生速度需要保持在平均每10分钟一个，
    由于比特币网络的总的计算
    能力在不停的变化，
    因此挖矿的难度需要频繁进行调整，
    这个周期为两周，
    准确地说是产生2016个区块花费的时间。
    随着挖矿难度的提升，
    独立矿工挖到新区块的平均时间将变得更长，
    并且很不稳定。
    为了避免这种收入不稳定的问题，
    一些矿工就组织共同进行挖矿并根据算力分享收益，这被称为矿池。
    大部分矿池由矿池管理着和矿工构成。
    管理者作为比特币网络上的节点运行完整的比特币协议，
    而矿工是通过运行矿池协议\cite{ref_web2}
    加入矿池而不是直接连接到比特币网络上。
    矿池管理者将未解决的挖矿任务分成一个个子任务分给矿工，
    矿工解决这些子任务后将产生PPoW和FPoW，
    并将他们提交给矿池管理者。
    PPoW是指没有挖出新的区块但是验证了一部分答案是错误的，
    FPoW是指找到了正确答案，也就是挖到区块。
    如果一个矿池中的矿工产生了FPoW并将它提交给管理者，
    管理者会立即将FPoW产生的新区块广播到比特币网络中。
    如果区块经过了其他大部分节点的验证并被采纳，
    那么矿池管理者将受到奖励，
    同时按照矿工贡献的PoW的比例将奖励分给矿工。
    比特币网络（挖矿部分）当前由独立矿工、允许任何人加入的开放矿池以及需要认证才能加入的私人矿池构成。

    
    \subsection{比特币挖矿过程}

    \indent

    区块链中的交易是以Merkle树\cite{ref_article2}的结构存储在区块中。
    区块链中每一个区块的头都包含了当前区块Merkle树根的哈希值、前一个区块的头哈希值、难度目标以及nonce值。
    在比特币系统中，挖矿其实就是不断地尝试nonce值，
    然后计算加密问题以此产生PoW。
    具体来说，挖矿的目标就是找到一个有效的nonce值满足$\ sha256(sha256(blkhdr)) < t $,
    其中 $\ blkhdr$ 是区块完整的头信息，
    $\ t$是一个根据比特币协议计算出来的256位的数值，称为难度目标。
    因为哈希计算是不可逆的，因此矿工只能通过不断的尝试nonce值来计算区块头的哈希，
    很明显这个的难度是很高的。
    为了保证区块的平均产生速度在10分钟左右，
    比特币系统每产生2016个区块后都要重新调整难度目标 $\ t$ 的值。
    当一个矿工发现一个有效的nonce值并且产生一个新的区块后会立即将新区块广播给比特币网络中的每个节点。
    当其他节点接收到新区块并通过验证后，
    会把新区块作为区块链的新的头。

    \subsection{区块链分叉}

    \indent

    比特币系统中的区块链分叉分为由挖矿产生的分叉\cite{ref_web3}和由版本升级产生的分叉\cite{ref_web4}，
    而由版本升级产生的分叉又分为软分叉和硬分叉，
    我们这里提到的分叉特指由挖矿产生的分叉，
    当两个矿工在很短的时间内相继挖到了有效的新的区块并将新区块广播到比特币网络上，
    由于网络存在延时，
    因此有些节点先收到了区块 $\ B_1$,
    而有些节点先收到了区块 $\ B_2$,
    通常情况下，
    节点会将先收到的区块作为区块链的新的头。
    所以，整个网络中就存在着一部分节点以区块$\ B_1$作为区块链的头而
    其他节点以区块$\ B_2$作为区块链的头，这就是由挖矿所产生的区块链分叉。
    在产生分叉后的新一轮挖矿中，
    会有一个分叉先算出来新的区块，
    那么这个分叉就是有效的，
    而另一个分叉是无效的。
    除了这种偶然产生的分叉外，
    分叉也可以人为地故意产生。
    当一个矿工先挖出了一个新区块但是不立即将其广播到网络上，
    知道矿工检测到网络中其他的节点也挖出了一个新的区块后才将自己的挖到的新区块广播出去，
    以此来故意产生分叉。
    这种故意产生的分叉可以被用于“双重支付”攻击\cite{ref_double_spending}和“selfish mining”攻击
    \cite{ref_selfish_mining1, ref_selfish_mining2, ref_selfish_mining3}。

    \section{Selfish Mining}

    \indent

    正常情况下，一个诚实的矿工产生一个FPoW后会立即将新区块广播到比特币网络上，
    但是在selfish mining攻击\cite{ref_selfish_mining1}中，
    攻击者不会立即将新区块广播出去，
    此时攻击者可以偷偷地开始挖新的区块，
    而其他诚实的矿工还在原有的公链上挖矿。
    如果攻击者发现了更多的新区块，
    就继续偷偷地往后面挖新区块。
    当公共分支的长度达到了私有分支的长度时，
    攻击者就将自己发现的新区快全部广播出去。

    \subsection{攻击原理}

    \indent

    Selfish mining攻击的核心思想就是使其他的诚实矿工在已经输掉的挖矿比赛中继续浪费算力。
    具体来说就是攻击者使得诚实的矿工将部分算力花在挖掘不可能成为区块链一部分的区块上，
    因为这一高度的区块早已经被攻击者挖到了。

    Selfish mining攻击者通过选择合适的时机发布自己挖到的区块从而使其他诚实的矿工做了无用的工作。
    通俗来讲，
    攻击者偷偷保存自己挖到的区块，
    然后人为地产生分叉，
    并在自己的这条私有的分叉上继续挖矿，
    然而诚实的矿工却还在较短原有的公共链上挖矿。
    因为攻击者的算力只占全网算力的一小部分，
    因此私有分叉的长度不会一直领先于公有链长度。
    所以，攻击者必须选择合适的时机将新区块发布出去，
    使得诚实的矿工放弃在原有的公链上挖矿而从新的区块开始挖，
    从而达到攻击的目的。
    这使得诚实矿工在公链上挖矿的工作都白费了，
    反过来就增加了攻击者的收入。


    \begin{algorithm}
        \caption{Selfish-Mine}

        \textbf{on} Init

            $\ \ \ \ $ public chain  $\leftarrow$ publickly known blocks

            $\ \ \ \ $ private chain $\leftarrow$ publickly known blocks

            $\ \ \ \ $ \textit{privateBranchLen} $\leftarrow$ 0

            $\ \ \ \ $ Mine at the head of the private chain.

        $ $
        
        \textbf{on} My pool found a block

            $\ \ \ \ $ $\Delta_{\textit{prev}}$ $\leftarrow$ length(private chain) - length(public chain)

            $\ \ \ \ $ append new block to private chain

            $\ \ \ \ $ \textit{privateBranchLen} $\leftarrow$ \textit{privateBranchLen} + 1

            $\ \ \ \ $ \textbf{if} $\Delta_{\textit{prev}} = 0$ \textit{and privateBranchLen} = 2 \textbf{then} \hfill (Was tie with branch of 1)

                $\ \ \ \ \ \ \ \ $ publish all of the private chain \hfill (Pool wins due to the lead of 1)

                $\ \ \ \ \ \ \ \ $ \textit{privateBranchLen} $\leftarrow$ 0
            
            $\ \ \ \ $ Mine at the new head of the private chain.
        
        $ $

        \textbf{on} Others found a block 

            $\ \ \ \ $ $\Delta_{\textit{prev}}$ $\leftarrow$ length(private chain) - length(public chain)
            
            $\ \ \ \ $ append new block to public chain 

            $\ \ \ \ $ \textbf{if} $\Delta_{\textit{prev}} = 0$ \textbf{then}

                $\ \ \ \ \ \ \ \ $ private chain $\leftarrow$ public chain \hfill (they win)

                $\ \ \ \ \ \ \ \ $ \textit{privateBranchLen} $\leftarrow$ 0
            
            $\ \ \ \ $ \textbf{else if} $\Delta_{\textit{prev}} = 1 $ \textbf{then}

                $\ \ \ \ \ \ \ \ $ publish last block of the private chain \hfill (Now same length. Try our luck)

            $\ \ \ \ $ \textbf{else if} $\Delta_{\textit{prev}} = 2 $ \textbf{then}

                $\ \ \ \ \ \ \ \ $ publish all of the private chain \hfill (Pool wins due to the lead of 1)

                $\ \ \ \ \ \ \ \ $ \textit{privateBranchLen} $\leftarrow$ 0
            
            $\ \ \ \ $ \textbf{else} \hfill ($\Delta_{\textit{prev}} > 2$)

                $\ \ \ \ \ \ \ \ $ publish first unpublished block in private block.
            
            $\ \ \ \ $ Mine at the head of the private chain.

    \end{algorithm}



    \clearpage

    \begin{thebibliography}{8}

    \bibitem{ref_article1}
    Satoshi Nakamoto. Bitcoin: A peer-to-peer electronic cash system. (2008).

    \bibitem{ref_web1}
    CoinMarketCap. Bitcoin Market Info. 
    \url{https://coinmarketcap.com/currencies/bitcoin/}. 
    (2018). [Online; accessed 10-Jun-2018].


    \bibitem{ref_web2}
    Stratum Mining Protocol. 
    \url{https://en.bitcoin.it/wiki/Stratum_mining_protocol}.
    (2018). [Online; accessed 10-Jun-2018].
    
    
    \bibitem{ref_article2}
    Ralph C Merkle. 1980. Protocols for Public Key Cryptosystems. In Symposium on
    Security and privacy. IEEE.

    \bibitem{ref_web3}
    Bitcoin.org. Bitcoin Developer Guide. 
    \url{https://bitcoin.org/en/developer-guide#block-height-and-forking}.
    (2018). [Online; accessed 10-Jun-2018].


    \bibitem{ref_web4}
    Bitcoin.org. Bitcoin Developer Guide. 
    \url{https://bitcoin.org/en/developer-guide#detecting-forks}.
    (2018). [Online; accessed 10-Jun-2018].

    \bibitem{ref_double_spending}
    Double Spending Risk Remains After July 4th Bitcoin Fork.
    \url{https://www.coindesk.com/double-spending-risk-bitcoin-network-fork/}. 
    (2018). [Online; accessed 10-Jun-2018].

    \bibitem{ref_selfish_mining1}
    Ittay Eyal and Emin Gün Sirer. 2014. Majority Is Not Enough: Bitcoin Mining
    Is Vulnerable. 
    In \textit{International Conference on Financial Cryptography and Data
    Security}. Springer.

    \bibitem{ref_selfish_mining2}
    Kartik Nayak, Srijan Kumar, Andrew Miller, and Elaine Shi. 2016. Stubborn
    Mining: Generalizing Selfish Mining and Combining with an Eclipse Attack. 
    In \textit{European Symposium on Security and Privacy}. IEEE.

    \bibitem{ref_selfish_mining3}
    Ayelet Sapirshtein, Yonatan Sompolinsky, and Aviv Zohar. 2015. Optimal Selfish
    Mining Strategies in Bitcoin.
    \textit{arXiv preprint arXiv:1507.06183} (2015).

    \bibitem{ref_FAW}
    Yujin Kwon, Dohyun Kim, Yunmok Son, Eugene Vasserman, and Yongdae Kim. 2017. 
    Be Selfish and Avoid Dilemmas: Fork After Withholding (FAW) Attacks on Bitcoin. 
    In Proceedings of the 2017 ACM SIGSAC Conference on Computer and Communications Security (CCS '17). 
    ACM, New York, NY, USA, 195-209. DOI: https://doi.org/10.1145/3133956.3134019

    \bibitem{ref_BWH1}
    MeniRosenfeld.2011.AnalysisofBitcoinPooledMiningRewardSystems.arXiv
    preprint arXiv:1112.4980 (2011).

    \bibitem{ref_BWH2}
    Nicolas T Courtois and Lear Bahack. 2014. 
    On Subversive Miner Strategies and Block Withholding Attack in Bitcoin Digital Currency. 
    arXiv preprint arXiv:1402.1718 (2014).

    \bibitem{ref_article3}
    LoiLuu,RatulSaha,InianParameshwaran,PrateekSaxena,andAquinasHobor. 2015. 
    On Power Splitting Games in Distributed Computation: The Case of Bitcoin Pooled Mining. 
    In \textit{Computer Security Foundations Symposium (CSF)}. IEEE.

    \bibitem{ref_book1}
    Author, F., Author, S., Author, T.: Book title. 2nd edn. Publisher,
    Location (1999)
    
    \bibitem{ref_proc1}
    Author, A.-B.: Contribution title. In: 9th International Proceedings
    on Proceedings, pp. 1--2. Publisher, Location (2010)

    
    
    \end{thebibliography}
    
    \end{CJK*}
    
    \end{document}